<!--
同步影响报告:
- 版本变更: 1.1.0 → 1.2.0
- 变更原因:
  * v1.0.1: 将宪章内容本地化为中文
  * v1.1.0: 将所有相关模板文件本地化为中文,实现完整的中文化工作流
  * v1.2.0: 新增测试驱动开发(TDD)原则,强化代码质量和可维护性保障
- 修改的原则:
  * 新增原则九 - 测试驱动开发(TDD)
- 新增章节:
  * 原则九 - 测试驱动开发(TDD)
- 删除章节: 无
- 需要更新的模板文件(v1.2.0):
  ✅ .specify/templates/plan-template.md (需添加TDD测试策略检查)
  ✅ .specify/templates/spec-template.md (无需修改 - 已包含测试场景)
  ✅ .specify/templates/tasks-template.md (需强调测试优先顺序)
  ✅ .specify/templates/checklist-template.md (需添加TDD验证项)
- 后续待办事项: 无
-->

# Cyborg 官网项目宪章

## 核心原则

### 一、服务端优先组件策略

所有组件必须默认使用服务端渲染,除非明确需要客户端交互。客户端组件必须使用 'use client' 指令标记,并且必须通过用户交互需求(表单、动画、浏览器 API、事件处理器)来证明其必要性。

**理由**: 服务端组件可以减少 JavaScript 包体积,提高首次页面加载性能,支持直接访问后端数据,并增强 SEO。客户端组件应该是例外而非常态,从而确保企业官网的最佳性能。

### 二、TypeScript 类型安全(不可协商)

所有组件、函数和模块必须使用 TypeScript 并提供完整的类型定义。每个组件必须定义明确的 Props 接口。任何使用 `any` 类型的情况必须在代码注释中说明理由,否则在审查时予以拒绝。

**理由**: 类型安全可以防止运行时错误,启用 IDE 自动补全,文档化组件契约,并确保代码的可维护性。企业级应用需要可预测、自文档化的代码。

### 三、设计系统一致性

所有 UI 组件必须使用 shadcn/ui 组件库构建。自定义组件必须遵循 shadcn/ui 的模式、设计令牌和 CSS 变量。任何直接的样式偏离都必须说明理由并记录在案。

**理由**: 一致的设计系统可以加速开发,确保品牌连贯性,简化维护,并提供经过实战检验的无障碍访问模式。shadcn/ui 提供了符合企业级质量标准的生产就绪、可定制组件。

### 四、样式规范

样式开发仅允许使用 Tailwind CSS 工具类。禁止使用内联样式和自定义 CSS-in-JS 解决方案,除非技术上必需(需说明理由)。所有组件必须应用移动端优先的响应式设计,使用 Tailwind 的响应式前缀。

**理由**: 工具优先的 CSS 可以减少样式表膨胀,防止特异性冲突,通过约束选择强制设计一致性,并支持快速迭代。移动端优先确保在所有设备上都有最佳体验。

### 五、无障碍访问与语义化 HTML(不可协商)

所有组件必须使用语义化 HTML5 元素。交互元素必须包含适当的 ARIA 属性、键盘导航支持和屏幕阅读器兼容性。表单必须有正确的标签和错误提示。

**理由**: 无障碍访问既是法律要求也是道德义务。语义化 HTML 可以改善 SEO、辅助技术兼容性和代码可维护性。企业网站需要服务具有不同能力的多样化用户群体。

### 六、性能优化

图片必须使用 Next.js Image 组件,配合适当的尺寸、格式(WebP/AVIF)和懒加载。异步操作必须包含加载状态和错误边界。重型组件必须通过动态导入应用代码拆分。必须定义并监控性能预算。

**理由**: 性能直接影响用户体验、转化率和 SEO 排名。企业网站必须在所有设备和网络条件下快速加载。Next.js Image 组件提供自动优化,降低基础设施成本并改善指标。

### 七、SEO 与元数据完整性

每个页面路由必须包含完整的元数据:标题、描述、OpenGraph 标签、Twitter 卡片、规范 URL,以及适用的结构化数据(JSON-LD)。元数据必须对每个页面唯一,并针对搜索引擎进行优化。

**理由**: 企业网站依赖自然搜索流量实现业务增长。全面的元数据确保正确的社交分享、搜索引擎索引和可发现性。缺失元数据会直接影响营销投资回报率。

### 八、单一职责与组件组合

每个组件必须具有单一、明确定义的目的。复杂功能必须由更小的、可复用的组件组合而成。组件文件不应超过 200 行;违反此规则必须说明理由。

**理由**: 小而专注的组件更易于测试、调试、复用和维护。组合方式支持灵活的功能开发,并防止代码变得难以修改的单体化。

### 九、测试驱动开发(不可协商)

所有新功能和重大代码变更必须遵循测试驱动开发(TDD)流程:先编写失败的测试,再实现功能代码,最后重构。组件必须具有单元测试覆盖核心逻辑,集成测试验证用户流程,端到端测试确保关键业务路径正常工作。测试必须具有可读性、可维护性,并作为代码行为的活文档。

**理由**: TDD 确保代码从设计之初就是可测试的,减少 bug 引入,提供即时反馈循环,并创建安全的重构网。测试先行迫使开发者思考接口设计和边界条件,产生更清晰、更模块化的代码。对于企业级应用,全面的测试覆盖是长期可维护性和业务连续性的保证,降低回归风险并加速功能迭代。

## 技术栈

**强制技术**:

- **框架**: Next.js 14+(App Router 架构)
- **UI 库**: React 18+ 配合 TypeScript
- **组件库**: shadcn/ui
- **样式**: Tailwind CSS
- **类型系统**: TypeScript 5+
- **图片优化**: Next.js Image 组件
- **测试框架**: Jest + React Testing Library(单元/集成测试)、Playwright 或 Cypress(E2E 测试)
- **代码质量**: ESLint + Prettier(通过 pre-commit hooks 强制执行)

**技术选择标准**: 任何额外的库或框架必须通过证明现有技术栈无法高效解决问题来证明其必要性。在采用前需评估包体积影响、维护负担和团队学习曲线。

## 开发工作流

### 项目结构

所有代码必须遵循以下目录组织:

```
/app                    # Next.js App Router 页面和布局
/components
  /ui                   # shadcn/ui 组件
  /sections             # 页面区块组件(英雄区、特性等)
  /layout               # 布局组件(Header、Footer、导航)
/lib                    # 工具函数和共享逻辑
/public                 # 静态资源(优化后的图片、字体)
/types                  # 共享的 TypeScript 类型定义
/__tests__              # 测试文件(镜像源代码结构)
  /unit                 # 单元测试
  /integration          # 集成测试
  /e2e                  # 端到端测试
```

**理由**: 一致的结构使团队成员能够快速定位代码,便于新人入职,并支持自动化工具。独立的测试目录确保清晰的测试组织。

### 必需的网站模块

企业官网实现必须包含以下标准模块(除非明确排除在范围之外):

- **英雄区(Hero Section)**: 主要价值主张和行动号召
- **特性区(Features Section)**: 产品/服务能力展示
- **关于区(About Section)**: 公司故事和使命
- **客户评价区(Testimonials Section)**: 客户社会证明
- **价格区(Pricing Section)**: 服务层级和价格透明度
- **常见问题区(FAQ Section)**: 常见问题和解答
- **联系表单(Contact Form)**: 潜在客户捕获和咨询处理
- **页脚(Footer)**: 导航、法律链接、社交媒体、公司信息

### TDD 工作流程

实施新功能时必须遵循以下 TDD 循环:

1. **红灯(Red)**: 编写一个失败的测试,描述期望的行为
2. **绿灯(Green)**: 编写最简单的代码使测试通过
3. **重构(Refactor)**: 在测试保护下优化代码结构
4. **重复**: 对每个新需求重复此循环

**测试层级要求**:

- **单元测试**: 测试独立函数、hooks 和组件逻辑,使用 Jest + React Testing Library
- **集成测试**: 验证多个组件协同工作,测试表单提交、API 交互等场景
- **E2E 测试**: 覆盖关键业务流程(用户注册、表单提交、页面导航),使用 Playwright 或 Cypress

**测试覆盖率标准**:

- 核心业务逻辑: 最低 80% 覆盖率
- 公共 API 和组件接口: 100% 覆盖率
- 工具函数: 最低 90% 覆盖率
- UI 组件渲染: 关键交互路径必须测试

### 代码生成标准

生成代码时:

1. 包含所有必要的 import 语句
2. 为复杂业务逻辑添加中文注释
3. 提供生产就绪、功能完整的代码(无占位符)
4. 定义清晰的 Props 类型,在有益的情况下添加 JSDoc 注释
5. 遵循命名约定:组件使用 PascalCase,函数使用 camelCase,常量使用 UPPER_SNAKE_CASE
6. **同步生成对应的测试文件**,遵循 TDD 原则

### 代码审查要求

所有代码变更必须:

- 通过 TypeScript 编译,无错误或警告
- 通过 ESLint 检查,无违规
- **所有测试通过,新功能有对应的测试覆盖**
- **测试必须在功能实现之前编写(TDD 流程验证)**
- 包含移动端/平板/桌面的响应式设计
- 为异步操作展示适当的加载状态
- 包含失败场景的错误处理
- 维持或改善 Lighthouse 性能分数
- 达到或超过项目测试覆盖率标准

## 治理

### 修订流程

宪章修订需要:

1. **提案**: 记录提议的变更及其理由和影响分析
2. **审查**: 团队审查技术影响和与项目目标的一致性
3. **批准**: 项目负责人/技术负责人批准并更新版本号
4. **迁移**: 更新所有模板、文档和现有代码以符合要求
5. **沟通**: 通知所有团队成员变更内容和新要求

### 版本管理

宪章遵循语义化版本(MAJOR.MINOR.PATCH):

- **MAJOR(主版本)**: 对核心原则的破坏性变更或移除强制性实践
- **MINOR(次版本)**: 添加新原则或显著扩展指导
- **PATCH(补丁版本)**: 澄清、措辞改进或非语义性改进

### 合规性

- 所有 pull request 在合并前必须根据宪章原则进行验证
- 原则违反必须在 PR 描述中说明理由并获得技术负责人批准
- 代码审查必须明确验证:TypeScript 类型、无障碍访问、性能优化、设计系统一致性、**以及 TDD 流程遵循**
- 每季度必须进行宪章审查,评估相关性并确定需要的更新

### 复杂度说明

任何违反简单性原则的情况(新依赖、超出既定技术栈的架构模式、使用自定义解决方案而非 shadcn/ui 组件)都必须记录:

- **什么(What)**: 引入了什么复杂性
- **为什么(Why)**: 为何必要(问题陈述)
- **为何不用简单方案(Why not)**: 为何更简单的替代方案不够用(已评估的替代方案)
- **影响(Impact)**: 包体积、维护负担、学习曲线

**版本**: 1.2.0 | **批准日期**: 2025-10-28 | **最后修订**: 2025-10-29
